<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Resource Code Generator</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
.output-box{background:#f6f8fa;border-radius:0.5rem;padding:1rem;font-family:monospace}
.glossary-row{background:#fffbe6!important}
.resource-list{margin-left:2rem}
.pdf-color{color:#e74c3c}
.fa-link{color:#2c6fbb}
</style>
</head>
<body class="bg-slate-50">
<div class="max-w-6xl mx-auto py-6 px-4">
  <h1 class="mb-3 text-2xl font-bold flex items-center gap-2 text-gray-800">
    <i class="fa fa-file-excel text-green-600"></i>
    Resource Code Generator
  </h1>
  <p class="text-gray-500 mb-3 text-sm">Upload Excel â†’ generates JSON + HTML. Glossary stays on top. (Now shows full module with title.)</p>

  <input id="fileInput" type="file" accept=".xlsx,.xls" 
         class="block w-full border border-gray-300 rounded-md text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 mb-4"/>

  <div id="preview" class="mb-6"></div>

  <h5 class="flex items-center justify-between text-base font-semibold text-gray-700 mb-1">
    Generated JSON 
    <button class="px-2 py-1 text-xs rounded-md border border-gray-300 text-gray-600 hover:bg-gray-100" onclick="copyOutput('jsonOutput')">
      <i class="fa fa-copy"></i> Copy
    </button>
  </h5>
  <div id="jsonOutput" class="output-box mb-6 whitespace-pre max-h-72 overflow-auto text-sm">JSON will appear here</div>

  <h5 class="flex items-center justify-between text-base font-semibold text-gray-700 mb-1">
    Generated HTML 
    <button class="px-2 py-1 text-xs rounded-md border border-gray-300 text-gray-600 hover:bg-gray-100" onclick="copyOutput('htmlOutput')">
      <i class="fa fa-copy"></i> Copy
    </button>
  </h5>
  <div id="htmlOutput" class="output-box mb-3 whitespace-pre-line max-h-72 overflow-auto text-sm">HTML will appear here</div>
</div>

<script>
const copyOutput=id=>navigator.clipboard.writeText(document.getElementById(id).innerText||'');
const extractActualUrl=o=>!o?'':typeof o=="string"?o:o.Target||o.target||o.url||o.href||(o.Rel&&o.Rel.Target)||'';
function normCell(c){if(!c)return{text:'',url:'',isHyperlink:!1};if(typeof c=="object"&&("v"in c||"w"in c||"l"in c||"t"in c)){let r=c.w!==undefined&&c.w!==null?c.w:c.v;if(typeof r=="object")r=c.w||JSON.stringify(r)||'';let t=String(r===undefined||r===null?'':r).trim(),l=c.l||c.hyperlink||null,u=extractActualUrl(l)||(t&&(t.startsWith("http")||t.includes("://"))?t:"");return{text:t,url:u,isHyperlink:!!l}}let s=String(c||'').trim();return{text:s,url:s&&(s.startsWith("http")||s.includes("://"))?s:'',isHyperlink:!1}}
function splitMulti(c){if(!c)return[];if(typeof c=="object"&&c.l)return[normCell(c)];let r=typeof c=="object"?(c.w!==undefined?c.w:c.v):c;r=r===undefined||r===null?'':String(r);if(!r.trim())return[];return r.split(/[\n;]+/).map(s=>{const t=s.trim();return{text:t,url:t&&(t.startsWith("http")||t.includes("://"))?t:'',isHyperlink:!1}}).filter(x=>x.text)}
const pdfHref=i=>i&&i.url&&i.url.toString().trim()?i.url:'#';
function linkDisplay(i){if(!i)return'';if(i.isHyperlink)return i.text||'';try{const u=new URL(i.url||i.text),h=u.hostname.toLowerCase();if(h.includes("google.com"))return"Google";if(h.includes("youtube.com"))return"YouTube";if(h.includes("github.com"))return"GitHub";return u.hostname.replace("www.","").split(".")[0]||i.text}catch(e){return i.text||''}}
document.getElementById("fileInput").addEventListener("change",e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{const data=new Uint8Array(ev.target.result),wb=XLSX.read(data,{type:"array"}),sheet=wb.Sheets[wb.SheetNames[0]];if(sheet["!merges"])sheet["!merges"].forEach(m=>{const s=XLSX.utils.encode_cell({r:m.s.r,c:m.s.c}),v=sheet[s]?sheet[s].v:'';for(let R=m.s.r;R<=m.e.r;++R)for(let C=m.s.c;C<=m.e.c;++C){const a=XLSX.utils.encode_cell({r:R,c:C});if(!sheet[a])sheet[a]={t:"s",v:v}}});processSheet(sheet)};r.readAsArrayBuffer(f)});
function processSheet(sheet){/* keep your JS same (omitted for brevity) */}
</script>
</body>
</html>